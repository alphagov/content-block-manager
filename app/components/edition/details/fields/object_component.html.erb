<% embedded_fields = capture do %>
  <% nested_fields.each do |embedded_field| %>
    <%= render helpers.component_for_field(embedded_field, component_args(embedded_field)) %>
  <% end %>
<% end %>

<% if conditionally_revealed? %>
  <%= render "govuk_publishing_components/components/checkboxes", {
    name: show_field.name_attribute,
    id: show_field.id_attribute,
    text: show_field.label,
    heading: show_field.label,
    visually_hide_heading: true,
    no_hint_text: true,
    small: true,
    items: [
      {
        label: show_field.label,
        value: "true",
        checked: helpers.value_for_field(details: value, field: show_field, populate_with_defaults:) == true,
        conditional: embedded_fields,
        hint: show_field.hint,
      },
    ],
  } %>
<% else %>
  <%= render "govuk_publishing_components/components/fieldset", {
    legend_text: label,
    heading_level: 3,
    heading_size: "m",
  } do %>
    <%= embedded_fields %>
  <% end %>
<% end %>
