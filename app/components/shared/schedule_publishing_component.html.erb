<% content_for :error_summary, render(Shared::ErrorSummaryComponent.new(object: edition)) %>

<%
  is_scheduled_param = params["schedule_publishing"]
%>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <%= form_with url: form_url, method: :put, id: "schedule_publishing", **data_attributes do %>

      <%= render "govuk_publishing_components/components/radio", {
        name: "schedule_publishing",
        id: "schedule_publishing",
        heading_size: "xl",
        error_items: helpers.errors_for(edition.errors, :schedule_publishing),
        items: [
          {
            value: "now",
            checked:  is_scheduled_param == "now",
            text: I18n.t("edition.schedule.now.cta"),
            hint_text: I18n.t("edition.schedule.now.hint"),
            bold: true,
          },
          {
            value: "schedule",
            checked: is_scheduled_param == "schedule",
            text: I18n.t("edition.schedule.later.cta"),
            hint_text: I18n.t("edition.schedule.later.hint"),
            bold: true,
            conditional: render("components/datetime_fields", {
              heading_size: "s",
              field_name: "scheduled_publication",
              prefix: "scheduled_at",
              date_heading: "Date",
              date_hint: "For example, 01 08 2025",
              time_hint: "For example, 09:30 or 19:30",
              error_items: helpers.errors_for(edition.errors, :scheduled_publication),
              year: {
                value: (year_param.presence&.to_i),
                id: "scheduled_at_scheduled_publication_1i",
                name: "scheduled_at[scheduled_publication(1i)]",
                label: "Year",
                width: 4,
              },
              month: {
                value: (month_param.presence&.to_i),
                id: "scheduled_at_scheduled_publication_2i",
                name: "scheduled_at[scheduled_publication(2i)]",
                label: "Month",
                width: 2,
              },
              day: {
                value: (day_param.presence&.to_i),
                id: "edition_scheduled_publication",
                name: "scheduled_at[scheduled_publication(3i)]",
                label: "Day",
                width: 2,
              },
              hour: {
                value: (hour_param.presence&.to_i),
                id: "scheduled_at_scheduled_publication_4i",
                name: "scheduled_at[scheduled_publication(4i)]",
              },
              minute: {
                value: (minute_param.presence&.to_i),
                id: "scheduled_at_scheduled_publication_5i",
                name: "scheduled_at[scheduled_publication(5i)]",
              },
            }),
          },
        ],
      } %>
    <% end %>

    <div class="govuk-button-group">
      <div>
        <%= render "govuk_publishing_components/components/button", {
          text: I18n.t("buttons.save_and_continue"),
          name: "save_and_continue",
          value: I18n.t("buttons.save_and_continue"),
          type: "submit",
          form: "schedule_publishing",
        } %>
      </div>
      <div>
        <% if is_rescheduling %>
          <%= render "govuk_publishing_components/components/button", {
            text: I18n.t("buttons.cancel"),
            name: "Cancel",
            value: I18n.t("buttons.cancel"),
            href: back_link,
            secondary_solid: true,
          } %>
        <% else %>
          <%= render Shared::CancelAndDeleteButtonComponent.new(url: helpers.
            edition_path(
              edition, redirect_path:
              helpers.document_path(edition.document)
            ),
          ) %>
        <% end %>
      </div>
    </div>
  </div>
</div>
